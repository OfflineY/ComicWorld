<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    <link href="css/reader.style.css" rel="stylesheet" media="screen">
    <script src="js/jquery.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
	<script src="js/lazeload.js"></script>
	<script src="js/util.js"></script>
</head>
<body>
<div class="navbar"><a href="/">首页</a><i class='mdi mdi-chevron-right'></i><a id="BackURL"></a><i class='mdi mdi-chevron-right'></i><span id="Now"></span></div>
<div id="img-list"></div>
<div id="bottomTEXT"></div>
<script>
$(function() {
	var img_list = $('#img-list');
	var cartoon = getQueryString('cartoon');
	var chapter = getQueryString('chapter');
	document.title = "Comic | "+chapter + ' - ' + cartoon;
	var e = cartoon;
	$("#BackURL").append(e);
	$("#Now").append(chapter);
	var host = window.location.host;
	$("#BackURL").attr("href","cartoon.html?cartoon=" + cartoon);
	$.getJSON('http://' + host + '/get_img_list?cartoon=' + cartoon + '&chapter=' + chapter,
		function (data) {
	        if (data['code'] != 0) {
                $('#wrong-content').text(JSON.stringify(data));
                metroDialog.open('#dialog');
                return;
            }
			var urls = data['img'];
			urls.forEach(function (url) {
				img_list.append(
					'<img src="./img/loading.png" lazy-src="'+ url +'"/>'
					);
			});
			new LazyLoad().init();
		});
		function PrefixInteger(num, length) {
  return (num / Math.pow(10, length)).toFixed(length).substr(2);
}
setInterval(function () {
  var date = new Date();
  var h = date.getHours();  
  var m = date.getMinutes();
  var m = PrefixInteger(m, 2);
  document.getElementById('bottomTEXT').innerHTML = "《"+cartoon + "》&nbsp;" + chapter + "&nbsp;&nbsp;|&nbsp;&nbsp;" + h + ":" + m;
}, 0);
});
</script>
</body>
</html>